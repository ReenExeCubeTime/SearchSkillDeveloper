parameters:
    uri: 'https://djinni.co/'
    pager_sequence_table: 'pd_sequence'
    profile_link_table: 'pd_profile_page_link'
    pager_root_path: '/developers/'
    pager_selector_next: '.next a'
    profile_link_selector: '.profile'

services:
    pd.scrap.client:
        public: false
        class: 'GuzzleHttp\Client'
        arguments:
            - { base_uri: '%uri%' }

    pd.sequence.repository:
        public: false
        class: 'AppBundle\Service\Scrapynizer\D\ListContentRepository'
        arguments:
            - '@doctrine.dbal.default_connection'
            - '%pager_sequence_table%'

    pd.sequence.pager:
        public: false
        class: 'ReenExe\Scrapynizer\Pager\PaginationHunter'
        arguments:
            - '%pager_root_path%'
            - '%pager_selector_next%'

    pd.sequence.link.collection.finder:
        public: false
        class: 'AppBundle\Service\Scrapynizer\LinkCollectionSelectorFinder'
        arguments:
            - '%profile_link_selector%'

    pd.path.process.repository:
        public: false
        class: 'AppBundle\Service\Scrapynizer\PathProcessRepository'
        arguments:
            - '@doctrine.dbal.default_connection'
            - '%profile_link_table%'

    pd.link.collection.analyzer:
        public: false
        class: 'AppBundle\Service\Scrapynizer\LinkCollectionAnalyzer'
        arguments:
            - '@pd.sequence.link.collection.finder'
            - '@pd.path.process.repository'

    pd.sequence.analyzer:
        public: false
        class: 'AppBundle\Service\Scrapynizer\D\SequenceContentAnalyzer'
        arguments:
            - '@pd.link.collection.analyzer'

    pd.sequence.scraper:
        public: false
        class: 'ReenExe\Scrapynizer\Scraper\SequenceScraper'
        arguments:
            - '@pd.scrap.client'
            - '@pd.sequence.repository'
            - '@pd.sequence.pager'
            - '@pd.sequence.analyzer'

    pd.content.analyzer:
        public: false
        class: 'AppBundle\Service\Scrapynizer\D\ContentAnalyzer'

    pd.target.scrap:
        public: false
        class: 'ReenExe\Scrapynizer\Scraper\CollectionScraper'
        arguments:
            - '@pd.scrap.client'
            - '@pd.path.process.repository'
            - '@pd.content.analyzer'

    pd.sequence.scrap.command.adapter:
        public: false
        class: 'AppBundle\Service\Scrapynizer\QueueCommandAdapter'
        arguments:
            - '@pd.sequence.scraper'

    pd.scrap.target.command.adapter:
        public: false
        class: 'AppBundle\Service\Scrapynizer\QueueCommandAdapter'
        arguments:
            - '@pd.target.scrap'

    pd.sequence.scrap.target.list.command:
        class: 'AppBundle\Command\Core\RunTimeQueueCommand'
        arguments:
            - 'd:sequence:scrap:target:list'
            - '@pd.sequence.scrap.command.adapter'
        tags:
            -  { name: 'console.command' }

    pd.scrap.target.command:
        class: 'AppBundle\Command\Core\RunTimeQueueCommand'
        arguments:
            - 'd:scrap:target'
            - '@pd.scrap.target.command.adapter'
        tags:
            -  { name: 'console.command' }
